<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cafe24.travelMaker.mapper.SightsMapper">

	<select id="selectSightsCate" resultType="SightsCate">
		select 
			sights_cate_num as sightsCateNum,
			sights_type as sightsType
		from 
			tb_sights_cate
	</select>
	
	<select id="selectDo" resultType="Do">
		select 
			do_num as doNum,
			do_name as doName
		from 
			tb_do
	</select>
	
	<select id="selectSi" resultType="Si" parameterType="String">
		select 
			si_num as siNum,
			si_name as siName
		from 
			tb_si
		where
			do_num =#{doNum}
	</select>
	<insert id="addSights" parameterType="Sights">
	  <selectKey order ="BEFORE" keyProperty="sightsNum" resultType ="String"> 
	 	 SELECT 
			case COUNT(*)
			when 0 then 'sights_1'
			ELSE CONCAT('sights_',MAX(CAST(SUBSTRING(sights_num,8) AS DECIMAL))+1) 
			END AS save_point_num
		FROM
			tb_sights
 	  </selectKey>
 		INSERT INTO tb_sights
			(sights_num, si_num, m_id, sights_cate_num, sights_name, sights_photo, sights_detail, sights_lat, sights_long, sights_addr, sights_web, sights_tel, sights_start_time, sights_close_time)
		VALUES(
			#{sightsNum},
			#{siNum},
			#{mId},
			#{sightsCateNum},
		    #{sightsName},
		    #{sightsPhoto},
		    #{sightsDetail},
		    #{sightsLat},
		    #{sightsLong},
		    #{sightsAddr},
		    #{sightsWeb},
		    #{sightsTel},
		    #{sightsStartTime},
		    #{sightsCloseTime})
	</insert>
</mapper>