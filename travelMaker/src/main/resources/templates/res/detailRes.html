<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorator="@{layout/default}">
<th:block layout:fragment="customTitle">
	<title>음식점 상세페이지</title>
</th:block>
<th:block layout:fragment="customCss">
<link rel="stylesheet" href="/dist/css/kakaoMapCss.css">
	<style>
		.carousel-item img {
			width: 400px;
			height: 400px;
		}
		
		 #sights-review {
			height: auto;
			width: 81vw;
		}
		
		.chart {
			width: 400px;
		
		}
		
		.reveiwIntro{
			font-size: 30px;
		}
		
		.reviewIntroTitle {
			width: 100%;
			font-size:24px
		}
		
		.form-check{
			margin-top:13px;
		}
		
		.reveiwTitle{
			font-size:20px;
			font-weight:bold;
		}
		.badge{
		font-size:16px;
		}
</style>
</th:block>
<th:block>
<th:block layout:fragment="customContents">
	<div th:replace="fragments/addReveiwModal :: addResReviewFragment"></div>
	<div th:replace="fragments/updateReviewModal :: updateResReviewFragment"></div>
	<div th:replace="fragments/reportReview :: reportResReviewFragment"></div>
	<div class="content-wrapper">
		<!-- Content Header (Page header) -->
	<section class="content-header">
		<div class="container-fluid">
			<div class="row mb-2">
				<div class="col-sm-6">
					<h1>음식점 상세페이지</h1>
				</div>
				<div class="col-sm-6">
					<ol class="breadcrumb float-sm-right">
						<li class="breadcrumb-item"><a href="#">res</a></li>
						<li class="breadcrumb-item active">detialRes</li>
					</ol>
				</div>
			</div>
		</div>
		<!-- /.container-fluid -->
	</section>
	<!-- Main content -->
	<!-- Default box -->
	<div class="card card-solid">
		<div class="card-body">
			<div class="row">
				<div class="col-12 col-sm-7">
					<p class="my-3" style="font-size:30px;" th:utext="|${res.resName} <span class='badge ${res.btnColor}'>${res.resOpen}</span><br> |"></p>

					<i class="fas fa-star"></i> <i class="fas fa-star"></i> 
					<i class="fas fa-star"></i> <i class="fas fa-star"></i>
					<span class="reveiwCnt">529개의 리뷰</span>
					<hr>
					<p th:text="${res.resDetail}"></p>
					
					<p th:utext="|<i class='far fa-clock'></i> &nbsp; ${res.resStartTime}- ${res.resCloseTime}|"></p>
					<p th:utext="|<i class='fas fa-map-marker-alt'></i>  &nbsp; ${res.resAddr} |"></p>
					<p>이 음식점을 주로 남성이 선호합니다</p>
					<p>이 음식점은 주로 혼자 여행온 사람들이 즐깁니다.</p>
					<p th:utext="|<i class='fas fa-tv'></i> ${res.resWeb}|"></p>
					<p th:utext="|<i class='fa fa-volume-control-phone'></i> ${res.resTel}|"></p>
					<p>
						<a th:href="@{/feedback/addFeedback(resNum=${res.resNum})}">
							<i class="far fa-edit"></i>
							이 게시물에 대한 피드백 남기기 						
						</a>
					</p>

				</div>
				<div class="col-12 col-sm-5">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">
									<strong>photos</strong>
								</h3>
								<span class="float-right">
									<a href="/moreResPhoto">사진 더보기
										<i class="fas fa-angle-double-right"></i>
									</a>
								</span>
							</div>
							<!-- /.card-header -->
							<div class="card-body">
								<div id="carouselExampleIndicators" class="carousel slide"
									data-ride="carousel">
									<ol class="carousel-indicators">
										<li data-target="#carouselExampleIndicators"
											data-slide-to="0" class="active"></li>
										<li data-target="#carouselExampleIndicators"
											data-slide-to="1"></li>
										<li data-target="#carouselExampleIndicators"
											data-slide-to="2"></li>
									</ol>
									<div class="carousel-inner">
										<div class="carousel-item active" style="">
											<img class="d-block w-100" th:src="@{/fileupload/{file}(file=${res.resPhoto})}"
												alt="First slide">
										</div>
										<div class="carousel-item">
											<img class="d-block w-100"
												src="https://placehold.it/900x500/3c8dbc/ffffff&text=I+Love+Bootstrap"
												alt="Second slide">
										</div>
										<div class="carousel-item">
											<img class="d-block w-100"
												src="https://placehold.it/900x500/f39c12/ffffff&text=I+Love+Bootstrap"
												alt="Third slide">
										</div>
									</div>
									<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
										<span class="carousel-control-prev-icon" aria-hidden="true"></span>
										<span class="sr-only">Previous</span>
									</a>
									<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
									   <span class="carousel-control-next-icon" aria-hidden="true"></span>
									   <span class="sr-only">Next</span>
									</a>
								</div>
							</div>
							<!-- /.card-body -->
						</div>
						<!-- /.card -->
					</div>

				</div>
			</div>
		</div>
		<div class="row mt-4" style="margin-left: 20px;">
			<nav class="w-100">
				<div class="nav nav-tabs" id="product-tab" role="tablist">
					<a class="nav-item nav-link" id="res-review-tab" data-toggle="tab" href="#res-review" role="tab" aria-controls="res-review" aria-selected="true">리뷰</a>
					<a class="nav-item nav-link" id="sights-map-tab" data-toggle="tab" href="#sights-map" role="tab" aria-controls="sights-map" aria-selected="false">주변</a> 
					<a class="nav-item nav-link active" id="event-tab" data-toggle="tab" href="#res-event" role="tab" aria-controls="res-event" aria-selected="false">이벤트</a>
				</div>
			</nav>
			<div class="tab-content p-3" id="nav-tabContent">
				<div class="tab-pane fade  show active row" id="res-review" role="tabpanel" aria-labelledby="res-review-tab">
					<div class="reviewIntroTitle">
						<span class="reveiwIntro">review</span>
						<button type="button" id="reveiwBtn" class="btn btn-outline-danger btn-lg float-right" >리뷰작성</button>
						<hr>
					</div>
					<div class="row">
					<div class="chart col-12 col-sm-4">
						<h4 style="margin-left: 7px">관광지 평점</h4>
						<canvas id="donutChart"style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
					</div>
					<div class="chart col-12 col-sm-4">
					  <h4>여행자 유형 </h4>
					  <div class="form-group">
					  <th:block  th:each="l: ${tripType}">
					  	 <div class="form-check">
					  	  <label class="form-check-label">
                          	<input class="form-check-input" type="radio" name="purpose" th:value="l.tripTypeNum">
                          	<span th:text ="${l.tripTypeName}"></span>
                          </label>
                        </div>
					  </th:block>
                      </div>
					</div>
					<div class="col-12 col-sm-4">
					  <h4>계절별</h4>
					  <div class="form-group">
                        <div class="form-check">
	                        <label class="form-check-label">
	                          <input class="form-check-input" type="radio" name="purpose">
	                      	    봄(3월-5월)
	                      	</label>
                        </div>
                        <div class="form-check">
	                        <label class="form-check-label">
	                          <input class="form-check-input" type="radio" name="purpose">
	                          	여름 (6월-8월)
	                        </label>
                        </div>
                        <div class="form-check">
	                        <label class="form-check-label">
	                          <input class="form-check-input" type="radio" name="purpose">
	                          	가을(9월-11월)
	                        </label>
                        </div>
                        <div class="form-check">
	                        <label class="form-check-label">
	                          <input class="form-check-input" type="radio" name="purpose">
	                       	      겨울(12월-2월)
	                       </label>
                        </div>
                  
                      </div>	
					</div>
					</div>
					<hr>
					<div class="post">
						<div class="card">
							<div class="card-header">
							   <div class="post">
               					  <div class="user-block">
               			            <img class="img-circle img-bordered-sm" src="../../dist/img/user1-128x128.jpg" alt="user image">
                        			<span class="username">
                               		 <a href="#">민수짱</a>님이 작성하신 리뷰입니다.
                      				 </span>
                           			 <span class="description">2020-05-29에 작성된 리뷰</span>
                           			<span class="float-right" style="font-size: 15px !important; margin-top: -15px;">
                           				<a href="#" data-toggle="modal"  data-target="#updateResReview">수정</a>/
                           				<a class="delReview">삭제</a>
                           			</span>
                        		 </div>
                  			  </div>
          			     	</div>
          			     	<div class="card-footer">
          			     		<i class="fas fa-star" style="color:green"></i>
          			     		<i class="fas fa-star" style="color:green"></i>
          			     		<i class="fas fa-star" style="color:green"></i> <br>
          			     		<span class="reveiwTitle">넘나 활기차고 살기좋은 내 인생</span>
          			     		<hr>
          			     		<span class="reveiwContents">
          			     			정말 배고프다,,,너무나도 재미있는 코딩 ^.^ 넘나 신나는것 ^^;;;;; 리뷰는 길게길게 작성해야 좋지 안그래 ??????????????????
          			     			근데 정말 할 말 없어,,,,,,,,,,,,할밀이 없어도 너무너무 없어!!!!!이런 제앚ㅇ!!!!그래도 한줄은 넘겨보자는 마음으로 해본다,,,ㅇㅈㅇㅈ
          			     		</span><br>
          			     		<div class="row">
                       			 <div class="col-sm-6">
                        		  <img class="img-fluid" src="../../dist/img/photo1.png" alt="Photo" width="300">
                       			 </div>
                      		  </div>
          			     		<span class="revewiPurpose">
          			     			<i class="fas fa-suitcase-rolling"></i>
          			     			여행 유형 :<strong>비지니스</strong>
          			     		</span><br>
          			     		<span class="visitDate">
          			     			<i class="far fa-calendar-check"></i>
          			     			<strong>2020년 5월</strong>에 다녀감
          			     		</span>
          			     	</div>
          			     	<div class="card-body">
          			     		 <a href="#"><i class="far fa-thumbs-up fa-2x"></i> 도움이되요</a>
          			     	</div>
               			</div>
					</div>
					<div class="post">
						<div class="card">
							<div class="card-header">
							   <div class="post">
               					  <div class="user-block">
               			            <img class="img-circle img-bordered-sm" src="../../dist/img/user1-128x128.jpg" alt="user image">
                        			<span class="username">
                               		 <a href="#">승연이</a>님이 작성하신 리뷰입니다.
                      				 </span>
                           			 <span class="description">2020-05-29에 작성된 리뷰</span>
                           			<span class="float-right" style="font-size: 15px !important; margin-top: -15px;">
                           				<a href="#" data-toggle="modal"  data-target="#reportResReview">신고</a>
                           			</span>
                        		 </div>
                  			  </div>
          			     	</div>
          			     	<div class="card-footer">
          			     		<i class="fas fa-star" style="color:green"></i>
          			     		<i class="fas fa-star" style="color:green"></i>
          			     		<i class="fas fa-star" style="color:green"></i> <br>
          			     		<span class="reveiwTitle">넘나 활기차고 살기좋은 내 인생</span>
          			     		<hr>
          			     		<span class="reveiwContents">
          			     			정말 배고프다,,,너무나도 재미있는 코딩 ^.^ 넘나 신나는것 ^^;;;;; 리뷰는 길게길게 작성해야 좋지 안그래 ??????????????????
          			     			근데 정말 할 말 없어,,,,,,,,,,,,할밀이 없어도 너무너무 없어!!!!!이런 제앚ㅇ!!!!그래도 한줄은 넘겨보자는 마음으로 해본다,,,ㅇㅈㅇㅈ
          			     		</span><br>
          			     		<div class="row">
                       			 <div class="col-sm-6">
                        		  <img class="img-fluid" src="../../dist/img/photo1.png" alt="Photo" width="300">
                       			 </div>
                      		  </div>
          			     		<span class="revewiPurpose">
          			     			<i class="fas fa-suitcase-rolling"></i>
          			     			여행 유형 :<strong>비지니스</strong>
          			     		</span><br>
          			     		<span class="visitDate">
          			     			<i class="far fa-calendar-check"></i>
          			     			<strong>2020년 5월</strong>에 다녀감
          			     		</span>
          			     	</div>
          			     	<div class="card-body">
          			     		 <a href="#"><i class="far fa-thumbs-up fa-2x"></i> 도움이되요</a>
          			     	</div>
               			</div>
					</div>		
				</div>
				<div class="tab-pane fade" id="sights-map" role="tabpanel" aria-labelledby="sights-map-tab">
				<div class="map_wrap">
					 <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
					    <ul id="category">    
					        <li id="CE7"  data-order="2">
					            <span class="category_bg pharmacy"></span>
					         	   카페
					        </li>  
					        <li id="CS2" data-order="2">
					            <span class="category_bg pharmacy"></span>
					                        편의점
					        </li>  
					        <li id="AT4"data-order="2"> 
					            <span class="category_bg pharmacy"></span>
					                       관광명소
					        </li> 
					        <li id="FD6"data-order="2">
					            <span class="category_bg pharmacy"></span>
					                        음식점
					        </li>     
					        <li id="AD5"data-order="2"> 
					            <span class="category_bg pharmacy"></span>
					                        숙박
					        </li>     
					    </ul>
					</div>
				</div>
				<div class="tab-pane fade" id="res-event" role="tabpanel" aria-labelledby="event-tab">			
					이벤트 준비중,,
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Modal -->

<!-- /.card -->
</th:block>
<th:block layout:fragment="customFooterScript">
<script src="/plugins/chart.js/Chart.min.js"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3db5bc02ace7e19d1c57294d93b2a474&libraries=services"></script>
<script src="/dist/js/kakaoMap.js"></script>
<script th:inline="javascript">
	/*<![CDATA[*/
	var lat = /*[[${res.resLat}]]*/;
	var lng = /*[[${res.resLong}]]*/;	
	var mId = /*[[${session.SID}]]*/;
	var isWrited =/*[[${isWrited}]]*/
	/*]]>*/
	
	$('#reveiwBtn').click(function(){
		console.log(mId);
		console.log(isWrited);
		if(mId == null ){
			alert('로그인 후 이용가능한 서비스 입니다.')
			window.location.href = '/member/login';
			return false;
		} else{
			if(isWrited >0){
				alert('리뷰는 한번만 작성 가능합니다 !');
			} else {
				$("#addResReview").modal();	
			}

			
		}
	})
	console.log(1);
	var myFn = kakaoMap(lat,lng);	
	console.log(lat,lng)
	console.log(2);
		var donutChartCanvas = $('#donutChart').get(0).getContext('2d')
		var donutData = {
			labels : [ '5점', '4점', '3점', '2점', '1점', ],
			datasets : [ {
				data : [ 700, 500, 400, 600, 300 ],
				backgroundColor : [ '#f56954', '#00a65a', '#f39c12',
						'#00c0ef', '#3c8dbc' ],
			} ]
		}
		var donutOptions = {
			maintainAspectRatio : false,
			responsive : true,
		}
		//Create pie or douhnut chart
		// You can switch between pie and douhnut using the method below.
		var donutChart = new Chart(donutChartCanvas, {
			type : 'doughnut',
			data : donutData,
			options : donutOptions
		})
		
	
		$(function(){
			$('.delReview').click(function(){
				var isDeleted = confirm('진짜 삭제하시겠어요?');
				console.log(isDeleted)
				if(isDeleted == true){
					$('.delReview').attr('href','/deleteSightsReveiw');				
				} else {
			
				}
	
			})
		})
	
		$(function(){
			$('input[name=declareCode]').click(function(){
				var declareCode = $(this).val();
				var declareDesc =$('textarea[name=declareDesc]'); 
				if(declareCode == "5"){
					declareDesc.css('display','block');
				} else {
					declareDesc.css('display','none');
				}	
			})
			
			$('#reportBtn').click(function(){
				var selected = $('input[name=declareCode]:checked').val()
				console.log(selected);
				var declareDesc =$('textarea[name=declareDesc]'); 
				if(selected == "5" && declareDesc.val()==''){
					alert('신고 사유를 작성해주세요.');
					declareDesc.focus();
					return;
				} 	
				$('#declareForm').submit();
			})
	})
</script>
</th:block>
</html>
