<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorator="@{layout/default}">
<th:block layout:fragment="customTitle">
	<title>ê´€ê´‘ëª…ì†Œ ìƒì„¸í˜ì´ì§€</title>
</th:block>
<th:block layout:fragment="customCss">
<link rel="stylesheet" href="/dist/css/kakaoMapCss.css">
<link rel="stylesheet" href="/dist/css/postDetailCss.css">
</th:block>
<th:block>
<th:block layout:fragment="customContents">
	<div th:replace="fragments/addReveiwModal :: addReviewFragment"></div>
	<div th:replace="fragments/updateReviewModal :: updateReviewFragment"></div>
	<div th:replace="fragments/reportReview :: reportReviewFragment"></div>
	<div class="content-wrapper">
		<!-- Content Header (Page header) -->
	<section class="content-header">
		<div class="container-fluid">
			<div class="row mb-2">
				<div class="col-sm-6">
					<h1>ê´€ê´‘ëª…ì†Œ ìƒì„¸í˜ì´ì§€</h1>
				</div>
				<div class="col-sm-6">
					<ol class="breadcrumb float-sm-right">
						<li class="breadcrumb-item"><a href="#">sights</a></li>
						<li class="breadcrumb-item active">detailSights</li>
					</ol>
				</div>
			</div>
		</div>
		<!-- /.container-fluid -->
	</section>
	<!-- Main content -->
	<!-- Default box -->
	<div class="card card-solid">
		<div class="card-body">
			<div class="row">
				<div class="col-12 col-sm-7">
					<p class="my-3" style="font-size:30px;" th:utext="|${sights.sightsName} <span class='badge ${sights.btnColor}'>${sights.sightsOpen}</span><br> |"></p>
					<th:block th:if="${gradeAvg != 0.0}">
					<th:block   th:each="num: ${#numbers.sequence(1,gradeAvg)}">
          				<i class="fas fa-star" style="color:green" ></i>	
          	 		</th:block> <strong th:text="|(${gradeAvg})|"></strong> 
          	 		<span class="reveiwCnt"  th:text="|${reviewCnt}ê°œì˜ ë¦¬ë·°|"></span>
          	 		</th:block>
					<p th:text="${sights.sightsDetail}"></p>
					<p th:utext="|<i class='far fa-clock'></i>  &nbsp; ${sights.sightsStartTime} - ${sights.sightsCloseTime}"></p>
					<p th:uText="|<i class='fas fa-map-marker-alt'></i> &nbsp;  ${sights.sightsAddr}|"></p>
					<th:block th:if="${genderPreference !=null}"> ï¸
					<p th:if ="${genderPreference != 'all'}"  th:utext="${genderPreference =='ë‚¨'?'ğŸ‘¦ğŸ» ë‚¨ì„±ì´ ì„ í˜¸í•˜ëŠ” ê´€ê´‘ëª…ì†Œ ì…ë‹ˆë‹¤!':'ğŸ‘©ğŸ» ì—¬ì„±ì´ ì„ í˜¸í•˜ëŠ” ê´€ê´‘ëª…ì†Œ ì…ë‹ˆë‹¤!'}">ì´ ì—¬í–‰ì§€ëŠ” ì—¬ì„±ì´ ì„ í˜¸í•˜ëŠ” ì—¬í–‰ì§€ì…ë‹ˆë‹¤</p>
					<p th:unless ="${genderPreference != 'all'}"> ğŸ‘ª  ëª¨ë“  ì„±ë³„ì´ ì„ í˜¸í•˜ëŠ” ê´€ê´‘ëª…ì†Œ ì…ë‹ˆë‹¤! </p>
					</th:block>
					<p>ì´ ì—¬í–‰ì§€ëŠ” í˜¼ì ì—¬í–‰í•˜ëŠ” ì‚¬ëŒë“¤ì´ ì„ í˜¸í•˜ëŠ” ì—¬í–‰ì§€ ì…ë‹ˆë‹¤</p>
					<p th:utext="|<i class='fas fa-tv'></i>  &nbsp; ${sights.sightsWeb}|"></p>
					<p th:utext="|<i class='fa fa-volume-control-phone'></i> &nbsp; ${sights.sightsTel}|"></p>
					<p>
						<a th:href="@{/feedback/addFeedback(sightsNum=${sights.sightsNum})}">
							<i class="far fa-edit"></i>
							ì´ ê²Œì‹œë¬¼ì— ëŒ€í•œ í”¼ë“œë°± ë‚¨ê¸°ê¸° 						
						</a>
					</p>
				</div>
				<div class="col-12 col-sm-5">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">
									<strong>photos</strong>
								</h3>
								<span class="float-right">
									<a th:href="@{/sights/moreSightsPhoto(sightsNum=${sights.sightsNum})}">ì‚¬ì§„ ë”ë³´ê¸°
										<i class="fas fa-angle-double-right"></i>
									</a>
								</span>
							</div>
							<!-- /.card-header -->
							<div class="card-body">
								<div id="carouselExampleIndicators" class="carousel slide"
									data-ride="carousel">
	
									<div class="carousel-inner">
										<div class="carousel-item active" style="">
											<img class="d-block w-100" th:src="@{/fileupload/{file}(file=${sights.sightsPhoto})}" alt="First slide">
										</div>
										<th:block th:each="pl : ${reviewPhotos}">
										<div class="carousel-item">
											<img class="d-block w-100" th:src="@{/fileupload/{file}(file=${pl})}" alt="First slide">
										</div>
										</th:block>
									</div>
									<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
										<span class="carousel-control-prev-icon" aria-hidden="true"></span>
										<span class="sr-only">Previous</span>
									</a>
									<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
									   <span class="carousel-control-next-icon" aria-hidden="true"></span>
									   <span class="sr-only">Next</span>
									</a>
								</div>
							</div>
							<!-- /.card-body -->
						</div>
						<!-- /.card -->
					</div>

				</div>
			</div>
		</div>
		<div class="row mt-4" style="margin-left: 20px;">
			<nav class="w-100">
				<div class="nav nav-tabs" id="product-tab" role="tablist">
					<a class="nav-item nav-link" id="sights-review-tab" data-toggle="tab" href="#sights-review" role="tab" aria-controls="sights-review" aria-selected="true">ë¦¬ë·°</a>
					<a class="nav-item nav-link" id="sights-map-tab" data-toggle="tab" href="#sights-map" role="tab" aria-controls="sights-map" aria-selected="false">ì£¼ë³€</a> 
					<a class="nav-item nav-link active" id="festival-tab" data-toggle="tab" href="#festival" role="tab" aria-controls="festival" aria-selected="false">ì¶•ì œ</a>
				</div>
			</nav>
			<div class="tab-content p-3" id="nav-tabContent">
				<div class="tab-pane fade" id="festival" role="tabpanel" aria-labelledby="festival-tab">			
					ì¶•ì œ ë¦¬ìŠ¤íŠ¸ ì¤€ë¹„ì¤‘..
				</div>
				<div class="tab-pane fade" id="sights-map" role="tabpanel" aria-labelledby="sights-map-tab">
					<div th:replace="fragments/kakaoMap :: kakaoMapFragment"></div>
				</div>
				<div class="tab-pane fade  show active row" id="sights-review" role="tabpanel" aria-labelledby="sights-review-tab">
					<div class="reviewIntroTitle">
						<span class="reveiwIntro">review</span>
						<button id="reveiwBtn" type="submit" class="btn btn-outline-danger btn-lg float-right" >ë¦¬ë·°ì‘ì„±</button>
						<hr>
					</div>
					<th:block th:unless="${!#lists.isEmpty(reviewList)}">
					<div class="row">
					   <h3>ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ë„¤ìš” ! ì²« ë¦¬ë·°ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš” </h3>
					</div>
					</th:block>
						<th:block th:if="${!#lists.isEmpty(reviewList)}">
				
	
					
					<div class="row">
					<div class="chart col-12 col-sm-4">
						<h4 style="margin-left: 7px">ê´€ê´‘ì§€ í‰ì </h4>
						<canvas id="donutChart"style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
					</div>
					<div class="chart col-12 col-sm-4">
					  <h4>ì—¬í–‰ì ìœ í˜• </h4>
					  	  <th:block  th:each="l: ${tripType}">
						  	 <div class="form-check">
						  	  <label class="form-check-label">
	                          	<input class="form-check-input" type="radio" name="purpose" th:value="l.tripTypeNum">
	                          	<span th:text ="${l.tripTypeName}"></span>
	                          </label>
	                        </div>
						  </th:block>
					</div>
					<div class="col-12 col-sm-4">
					  <h4>ê³„ì ˆë³„</h4>
					  <div class="form-group">
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="purpose">
                          <label class="form-check-label">ë´„(3ì›”-5ì›”)</label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="purpose">
                          <label class="form-check-label">ì—¬ë¦„(6ì›”-8ì›”)</label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="purpose">
                          <label class="form-check-label">ê°€ì„(9ì›”-11ì›”)</label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="purpose">
                          <label class="form-check-label">ê²¨ìš¸(12ì›”-2ì›”)</label>
                        </div>
                        <div class="form-check">
                        <input class="form-check-input" type="radio" name="purpose">
                          <label class="form-check-label">ë‚˜ í™€ë¡œ ì—¬í–‰</label>
                        </div>
                      </div>
					</div>
					</div>
					<hr>
			<th:block th:each ="rl: ${reviewList}">
				<div class="col-md-12">
           		 <!-- Box Comment -->
            	<div class="card card-widget">
             	 <div class="card-header">
             	   <div class="user-block">
             	 	  <img class="img-circle img-bordered-sm" th:src="@{/fileupload/{file}(file=${rl.member.mAvatar})}"alt="user image">
                  	  <span class="username"><a href="#" th:text="${rl.member.mId}"></a></span>
                     <span class="description" th:text="|${rl.sightsReveiwRegDate}"></span>
                  </div>
                <!-- /.user-block -->
                <div class="card-tools" style="margin-top:25px">
           			<span class="float-right" style="font-size: 15px !important; margin-top: -15px;" th:if="${rl.member.mId eq session.SID}">
           				<a href="#" data-toggle="modal"  data-target="#updateResReview">ìˆ˜ì •</a>/
           				<a class="delReview"  href="#"  th:sightsReviewNum = "${rl.sightsReviewNum}" th:sightsNum ="${sights.sightsNum}">ì‚­ì œ</a>
           			</span>
           			<span class="float-right" style="font-size: 15px !important; margin-top: -15px;" th:unless="${rl.member.mId eq session.SID}">
           				<a href="#" data-toggle="modal"  data-target="#reportResReview">ì‹ ê³ </a>
           			</span>
                </div>
                <!-- /.card-tools -->
              </div>
              <!-- /.card-header -->
		              <div class="card-body">
		              <th:block  th:each="num: ${#numbers.sequence(1,rl.sightsReviewGrade)}">
		          		<i class="fas fa-star" style="color:green" ></i>
		          	 </th:block> <br>
		          	 	<span class="reveiwTitle" th:text="${rl.sightsReviewTitle}"></span>
		                <hr>
						<span class="reveiwContents" th:text="${rl.sightsReviewContents}"></span><br>
       			     		<div class="row">
                    			 <div class="col-sm-6">
           						 <img class="img-fluid"  th:if ="${rl.sightsReviewPhoto !=''}" th:src="@{/fileupload/{file}(file=${rl.sightsReviewPhoto})}" alt="Photo" width="300">
                    			 </div>
                   		  </div>
       			     		<span class="revewiPurpose">
       			     			<i class="fas fa-suitcase-rolling"></i>
       			     			ì—¬í–‰ ìœ í˜• :<strong th:text="${rl.tripType.tripTypeName}"></strong>
       			     		</span><br>
       			     		<span class="visitDate">
       			     			<i class="far fa-calendar-check"></i>
       			     		<strong th:text="${rl.sightsVisitDate}"></strong>ì— ë‹¤ë…€ê°
       			     		</span><br><br>
          					<a style="color:#01579B"  class="likeBtn" th:sightsReviewMid ="${rl.member.mId}" th:sightsReviewNum = "${rl.sightsReviewNum}" th:data-info ="${rl.isLiked ? 'unlike':'like'}">
       			     		 <i class="icon" th:class="${rl.isLiked ? 'fa fa-thumbs-up fa-2x' : 'far fa-thumbs-up fa-2x'}"></i> ë„ì›€ì´ë˜ìš”</a>
		                <button class="float-right btn btn-primary showComments" toggle="show" th:reviewNum="${rl.sightsReviewNum}" th:reviewWriter ="${rl.member.mId}">comments</button>
			              </div>
			              <!-- /.card-body -->
			     	    <div class="comments-warp" style="display:none;"> 
							<div class="card-footer card-comments">
		             		</div>
		             		 <div class="card-footer">
		                 		<img class="img-fluid img-circle img-sm" th:src="@{/fileupload/{file}(file=${session.SAVATAR})}" alt="Alt Text">
				                  <div class="img-push">
				                    <input type="text" class="form-control form-control-sm inputComments" placeholder="Press enter to post comment" th:reviewNum="${rl.sightsReviewNum}"th:reviewWriter ="${rl.member.mId}">
				                  </div>
              				</div>
			    		</div>
			            </div>
			            <!-- /.card -->
			          </div>
			          </th:block>
			          </th:block>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Modal -->

<!-- /.card -->
</th:block>
<th:block layout:fragment="customFooterScript">
	<script src="/plugins/chart.js/Chart.min.js"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3db5bc02ace7e19d1c57294d93b2a474&libraries=services"></script>
	<script src="/dist/js/kakaoMap.js"></script>
	<script src="/dist/js/commonAjax.js"></script>
	<script src="/dist/js/postDetailJs.js"></script>
	<script th:inline="javascript">
	
	/*<![CDATA[*/
		var lat = /*[[${sights.sightsLat}]]*/;
		var lng = /*[[${sights.sightsLong}]]*/;	
		var mId = /*[[${session.SID}]]*/;
		var isWrited =/*[[${isWrited}]]*/;
		var gradeArr =/*[[${reviewGradeCnt}]]*/
	/*]]>*/

	$('.showComments').click(function(){
		showComments($(this),mId,'getSightsCommentsList');
	})

	$('.inputComments').keydown(function(key){
		addComments($(this),mId,'addSightsReivewComments',key);
	})
	
	showReveiwModal(mId,isWrited,$($("#addReview")));

    reveiwChart(gradeArr);
	
	$('.likeBtn').click(function(){ // ì¢‹ì•„ìš” ë²„íŠ¼ì„ ëˆŒë €ì„ë•Œ 
		if(mId == null || mId == ''){
			goLogin();
			return false;
		}
		var dataInfo = $(this).attr('data-info');
		var url = null;
		var reviewNum = $(this).attr('sightsReviewNum');
		var reviewWriter =$(this).attr('sightsReviewMid');
	
		if(dataInfo =='like'){
			url = 'likeSightsReview';
			$(this).attr('data-info','unlike');
			$(this).children().first().removeClass('far fa-thumbs-up fa-2x').addClass('fa fa-thumbs-up fa-2x')
		
		} else {
			url = 'unLikeSightsReview';
			$(this).attr('data-info','like');
			$(this).children().first().removeClass('fa fa-thumbs-up fa-2x').addClass('far fa-thumbs-up fa-2x')
		}
		
		commonAjax('/ajax/'+url,
				{"mId" :mId, "reviewNum" :reviewNum,"reviewWriter":reviewWriter},
				function(data){
						console.log(data);
				},'Get');	

	})
	
	var myFn = kakaoMap(lat,lng);
		$(function(){
			$('.delReview').click(function(){
				var isDeleted = confirm('ì§„ì§œ ì‚­ì œí•˜ì‹œê² ì–´ìš”?');
				var sightsReviewNum = $(this).attr('sightsReviewNum')
				var sightsNum = $(this).attr('sightsNum')
				if(isDeleted == true){
					$('.delReview').attr('href','/review/deleteSightsReview?sightsReviewNum='+sightsReviewNum+'&sightsNum='+sightsNum);				
				} else {
			
				}
	
			})
		})
	
		$(function(){
			$('input[name=declareCode]').click(function(){
				var declareCode = $(this).val();
				var declareDesc =$('textarea[name=declareDesc]'); 
				if(declareCode == "5"){
					declareDesc.css('display','block');
				} else {
					declareDesc.css('display','none');
				}	
			})
			
			$('#reportBtn').click(function(){
				var selected = $('input[name=declareCode]:checked').val()
				console.log(selected);
				var declareDesc =$('textarea[name=declareDesc]'); 
				if(selected == "5" && declareDesc.val()==''){
					alert('ì‹ ê³  ì‚¬ìœ ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.');
					declareDesc.focus();
					return;
				} 	
				$('#declareForm').submit();
			})
	})
	
	$(document).on('click','.deleteComments',function(){
	
		deleteComments($(this),'deleteSightsReivewComment');
   })
</script>
</th:block>
</html>
